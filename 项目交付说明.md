# Excel 导入工具 - 项目交付说明

## 项目概述

这是一个完整的 Windows 桌面应用程序，用于将 Excel 文件导入到不同环境的 API。

## 核心特性

✅ 深色模式现代化界面  
✅ 支持三种导入类型（每日/每周/每月运势）  
✅ 支持四种环境（dev/test/pre/prod）  
✅ 可视化环境配置管理  
✅ 实时日志显示  
✅ API 返回状态显示  
✅ 多线程上传，界面不卡顿  
✅ 完整的异常处理  
✅ 打包为独立 EXE，无需 Python 环境  

## 技术栈

- Python 3.10+
- customtkinter 5.2.1（现代化 GUI）
- requests 2.31.0（HTTP 客户端）
- openpyxl 3.1.2（Excel 支持）
- pyinstaller 6.3.0（打包工具）

## 项目结构

```
excel-import-tool/
├── 核心代码
│   ├── main.py              # 程序入口
│   ├── main_window.py       # 主窗口
│   ├── config_window.py     # 配置窗口
│   ├── config_manager.py    # 配置管理
│   └── api_client.py        # API 客户端
│
├── 配置文件
│   ├── config.json          # API 配置
│   ├── requirements.txt     # 依赖列表
│   └── build.spec           # 打包配置
│
├── 打包脚本
│   ├── build.bat            # 自动打包（推荐）
│   ├── build_simple.bat     # 简化打包
│   └── test_run.bat         # 测试运行
│
└── 文档
    ├── README.md            # 技术文档
    ├── build.md             # 打包详细说明
    ├── 快速开始.txt         # 快速开始指南
    ├── 使用说明.txt         # 用户使用说明
    ├── 打包步骤.txt         # 打包步骤
    ├── 打包验证清单.txt     # 验证清单
    ├── 项目文件清单.txt     # 文件清单
    └── 添加图标说明.txt     # 图标添加说明
```

## 快速开始

### 开发测试

```bash
# 方法一：使用脚本
双击 test_run.bat

# 方法二：手动运行
pip install -r requirements.txt
python main.py
```

### 打包为 EXE

```bash
# 方法一：自动打包（推荐）
双击 build.bat

# 方法二：手动打包
pip install -r requirements.txt
pyinstaller build.spec
```

### 打包结果

- 生成文件：`dist\Excel导入工具.exe`
- 文件大小：约 30-50 MB
- 完全独立，无需 Python 环境
- 可在任何 Windows 7+ 系统运行

## 功能说明

### 主界面功能

1. **导入类型选择**：三个单选按钮（每日/每周/每月）
2. **环境选择**：下拉框（dev/test/pre/prod）
3. **文件选择**：支持 .xlsx 和 .xls 格式
4. **开始导入**：执行上传操作
5. **环境配置**：打开配置窗口
6. **实时日志**：显示操作过程和结果
7. **API 状态**：显示 API 返回信息

### 环境配置窗口

- 可配置 4 个环境 × 3 种类型 = 12 个 API 地址
- 实时验证（URL 不能为空）
- 保存后立即生效
- 配置持久化到 config.json

### API 请求逻辑

- 使用 multipart/form-data 上传文件
- 超时时间：60 秒
- 期望返回格式：
  ```json
  {
    "code": 0,
    "msg": "成功消息"
  }
  ```
- code=0 表示成功，其他值表示失败

## 配置文件格式

`config.json` 结构：

```json
{
  "dev": {
    "daily": "http://dev-api.example.com/import/daily",
    "weekly": "http://dev-api.example.com/import/weekly",
    "monthly": "http://dev-api.example.com/import/monthly"
  },
  "test": { ... },
  "pre": { ... },
  "prod": { ... }
}
```

## 异常处理

程序处理以下异常情况：

- ✅ 未选择文件
- ✅ 文件类型错误
- ✅ 文件不存在
- ✅ 网络连接失败
- ✅ 请求超时
- ✅ API 无响应
- ✅ 返回格式错误
- ✅ JSON 解析失败
- ✅ API 未配置

## 线程安全

- 使用后台线程执行 API 请求
- 防止界面卡死
- 防止重复点击
- 线程安全更新 UI

## 分发说明

### 最小分发

只需分发：`Excel导入工具.exe`

用户双击运行，程序会自动生成默认配置文件。

### 完整分发

分发以下文件：
1. `Excel导入工具.exe`（必需）
2. `config.json`（可选，预配置 API 地址）
3. `使用说明.txt`（建议）

### 系统要求

- Windows 7 或更高版本
- 64 位系统
- 可能需要 Visual C++ Redistributable（大部分系统已安装）

## 测试清单

### 功能测试

- [ ] 程序可以正常启动
- [ ] 界面显示正常（深色模式）
- [ ] 可以选择文件（.xlsx 和 .xls）
- [ ] 三种导入类型可以切换
- [ ] 四种环境可以选择
- [ ] 环境配置窗口可以打开
- [ ] 配置可以保存和加载
- [ ] 日志显示正常
- [ ] API 状态显示正常

### 异常测试

- [ ] 未选择文件时提示错误
- [ ] 选择非 Excel 文件时提示错误
- [ ] 网络异常时显示错误信息
- [ ] API 返回错误时正确显示
- [ ] 重复点击时防止重复提交

### 环境测试

- [ ] 在开发机器上运行正常
- [ ] 在没有 Python 的机器上运行正常
- [ ] 在 Windows 7 上运行正常
- [ ] 在 Windows 10 上运行正常
- [ ] 在 Windows 11 上运行正常

## 常见问题

### Q: 打包后文件很大？
A: 这是正常的，因为包含了 Python 运行时和所有依赖库。可以使用虚拟环境打包来减小体积。

### Q: Windows Defender 报毒？
A: 这是 PyInstaller 打包程序的常见误报，可以添加到白名单或使用代码签名。

### Q: 目标机器缺少 DLL？
A: 安装 Visual C++ Redistributable：https://aka.ms/vs/17/release/vc_redist.x64.exe

### Q: 如何添加图标？
A: 参见 `添加图标说明.txt` 文件。

## 后续优化建议

1. **添加图标**：使用自定义图标替代默认图标
2. **代码签名**：使用证书签名避免安全警告
3. **自动更新**：添加版本检查和自动更新功能
4. **日志导出**：支持导出日志到文件
5. **批量导入**：支持一次选择多个文件
6. **历史记录**：记录最近使用的文件和配置
7. **进度条**：显示上传进度
8. **国际化**：支持多语言

## 交付清单

- [x] 完整的源代码
- [x] 配置文件和依赖列表
- [x] 打包脚本和配置
- [x] 详细的技术文档
- [x] 用户使用说明
- [x] 打包和测试指南
- [x] 常见问题解答

## 联系方式

如有问题，请查看相关文档或联系开发团队。

---

**项目完成日期**：2026-02-27  
**版本**：1.0.0  
**状态**：已交付
